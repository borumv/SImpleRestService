import React, { useEffect, useState } from 'react';
import {useParams} from 'react-router-dom'
import Form, {
  SimpleItem,
  GroupItem,
  Label,
} from 'devextreme-react/form';
import { Button } from 'devextreme-react/button';
import TagBox from 'devextreme-react/tag-box';
import 'devextreme-react/text-area';
import notify from 'devextreme/ui/notify';
import RestService from '../../services/tradeUnionService'
import 'devextreme-react/text-area';
import './styles.css'
import DxTablePageDeep from './../../components/tablePage/dxTablePage/dxTablePageDeep'

const TradeUnionForm = () =>{
  
    const union = useParams()
    const [data, setData] = useState()
    const rest = new RestService();
    const [unionId, setUniuonId] = useState(3)

    function refreshForm(){
       setUniuonId(union.id)
       rest.byKey('/union', union.id)
            .then(item =>{
              setData(item)
              console.log('Union', item)
            })}
    
    useEffect(()=>{
      refreshForm()
    }, [])

    const birthDateOptions = {
        width: '100%'
    }
  
    const avatarRender = () =>{
        return (
          <div className="form-avatar"></div>
        );}

    const onClicked = (e)=>{
      rest.update('/union', data.id, data)
      notify('Данные сохранены')
    }
    useEffect(() =>{
      const errorList = rest.getError()
      console.log("USEEFFECT errorList -" ,  errorList)
    }, [onClicked])

    return(
        <>
        <Form formData={data}
          labelMode ='static'>
        <GroupItem cssClass="first-group" colCount={4}>
            <SimpleItem render={avatarRender}>
            </SimpleItem>
            <GroupItem colSpan={3}>
              <SimpleItem dataField="nameUnion"  width = '100%'/>
              <SimpleItem dataField="city" />
          </GroupItem>
        </GroupItem>
            
            <SimpleItem dataField="address"  colSpan = {2} editorType="dxTextArea" height = '140' >
                  <Label alignment="center" />
              </SimpleItem>
              <SimpleItem colSpan = {2}>
                <Button 
                        onClick ={onClicked}
                        stylingMode="contained"
                        type="default"
                        width={120}
                        icon="floppy"
                        
                        />
              </SimpleItem>  
              <SimpleItem colSpan = {1}>
                <h1 alignment = "center">Members</h1>
              </SimpleItem>
              <SimpleItem colSpan={2}>

              </SimpleItem>
              <SimpleItem colSpan = {2}>
                  <DxTablePageDeep table={`/union/${unionId}/members`} id='3' path='persons' adding = {true} crudpath='/persons' />
              </SimpleItem>       
      </Form>
      </>
    );
  }

export default TradeUnionForm;