import React, { useEffect, useRef, useCallback, useMemo } from 'react';
import TreeView from 'devextreme-react/tree-view';
import { useNavigation } from '../../contexts/navigation';
import './side-navigation-menu.scss';
import {navigationDx} from '../../pages/routes' 
import { useNavigate } from "react-router-dom";

import * as events from 'devextreme/events';

export default function SideNavigationMenu(props) {
  const {
    children,
    selectedItemChanged,
    openMenu,
    compactMode,
    onMenuReady
  } = props;


  console.log('init navigation -' , props)
  // const { navigationData: { currentPath } } = useNavigation();
  const navigate = useNavigate()
  const treeViewRef = useRef();
  const wrapperRef = useRef();
  const getWrapperRef = useCallback((element) => {
    const prevElement = wrapperRef.current;
    if (prevElement) {
      events.off(prevElement, 'dxclick');
    }

    wrapperRef.current = element;
    events.on(element, 'dxclick', e => {
      openMenu(e);
    });
  }, [openMenu]);

  const selectItem = (item) =>{
    if(item.node.children.length === 0){
      navigate(item.node.key)
    }

 }

  return (
    <div
      className={'dx-swatch-additional side-navigation-menu'}
      ref={getWrapperRef}
    >
      {children}
      <div className={'menu-container'}>
        <TreeView
          id={'simple-treeview'}
          ref={treeViewRef}
          items={navigationDx}
          keyExpr={'path'}
          selectionMode={'single'}
          focusStateEnabled={false}
          expandEvent={'click'}
          onItemClick={selectItem}
          onContentReady={onMenuReady}
          width={'100%'}
        />
      </div>
    </div>
  );
}
